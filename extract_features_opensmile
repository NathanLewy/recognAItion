import opensmile
import pandas as pd
import os
import random

# Paths
training_folder = "AudioWAV_Train"
output_folder = "ExtractedFeatures"

# Create output folder if it doesn't exist
os.makedirs(output_folder, exist_ok=True)

# Initialize OpenSMILE
smile = opensmile.Smile(
    feature_set=opensmile.FeatureSet.eGeMAPSv02,
    feature_level=opensmile.FeatureLevel.LowLevelDescriptors
)

# List all .wav files in the training folder
wav_files = [f for f in os.listdir(training_folder) if f.endswith('.wav')]

# Select 10 random files
random_files = random.sample(wav_files, min(10, len(wav_files)))

# Process each file and save features in a separate file
for file in random_files:
    audio_file = os.path.join(training_folder, file)
    features = smile.process_file(audio_file)
    
    # Select specific features (mfcc, jitter, and pitch)
    selected_features = features.iloc[:, 6:12]  # Adjust columns if needed
    
    # Save to a CSV file
    output_csv = os.path.join(output_folder, f"{os.path.splitext(file)[0]}_features.csv")
    selected_features.to_csv(output_csv, index=False)
    print(f"Extracted features saved to {output_csv}")

print(f"Extracted features from {len(random_files)} files. Files saved in {output_folder}.")
